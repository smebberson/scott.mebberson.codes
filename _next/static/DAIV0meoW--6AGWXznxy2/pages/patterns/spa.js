(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{DZ1R:function(e,t,n){"use strict";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r=n("MX0m"),o=n.n(r),l=n("q1tI"),s=n.n(l),c=s.a.createElement;t.a=function(e){var t,n=e.backgroundColor,i=void 0===n?"aquamarine":n,r=e.children,l=void 0===r?"":r,u=e.date,h=e.emojis;if("string"!==typeof l)throw Error("PageTitle only accepts string as children.");var d=(t=[]).concat.apply(t,a(l.split(" ").map((function(e,t){return[e,s.a.createElement("br",{key:t})]}))));return c("header",{className:"jsx-3740271250 "+o.a.dynamic([["2671492827",[i]]])},c("div",{className:"jsx-3740271250 "+o.a.dynamic([["2671492827",[i]]])+" constrained"},c("time",{className:"jsx-3740271250 "+o.a.dynamic([["2671492827",[i]]])},u),c("p",{className:"jsx-3740271250 "+o.a.dynamic([["2671492827",[i]]])},d),c("h1",{className:"jsx-3740271250 "+o.a.dynamic([["2671492827",[i]]])},d),h&&c("span",{className:"jsx-3740271250 "+o.a.dynamic([["2671492827",[i]]])},h)),c(o.a,{id:"2671492827",dynamic:[i]},["header.__jsx-style-dynamic-selector{background-color:".concat(i,";}")]),c(o.a,{id:"3740271250"},["header.jsx-3740271250{margin-bottom:3em;padding:6em 0px 3em 0px;position:relative;}","time.jsx-3740271250{font-size:0.8em;font-weight:600;position:absolute;top:4.2em;}","h1.jsx-3740271250{font-family:'Bungee Shade',sans-serif;font-size:5em;margin:0px;text-align:left;}","p.jsx-3740271250{font-family:'Libre Barcode 128',sans-serif;font-size:2em;line-height:0px;margin:0px;}","span.jsx-3740271250{display:block;margin-top:0.5em;}"]))}},F1wk:function(e,t,n){"use strict";var i=n("q1tI"),a=n.n(i),r=n("5Yp1"),o=n("DZ1R"),l=a.a.createElement;t.a=function(e){var t=e.children,n=e.color,i=void 0===n?"#9400D3":n,a=e.title;return l(r.a,null,l(o.a,{backgroundColor:i},a),l("div",{className:"constrained"},t))}},NawR:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/patterns/spa",function(){return n("OfIN")}])},OfIN:function(e,t,n){"use strict";n.r(t);var i=n("q1tI"),a=n.n(i),r=n("yhlQ"),o=n("h1bS"),l=n("aOVY"),s=n("F1wk"),c=n("xnUM"),u=a.a.createElement;t.default=function(){return u(s.a,{color:c.c,title:"SPA"},u(o.a,null,"JWT Authentication"),u("p",null,"The basic premise of this JWT authentication pattern is that the front-end authenticates via a GraphQL API with a valid JWT on each request."),u("p",null,"Attributes of this pattern include:"),u("ul",null,u("li",null,"Using a JWT."),u("li",null,"Splitting the JWT across two cookies."),u("li",null,"Ensuring the entire JWT is not available to JavaScript."),u("li",null,"Works with and without a browser (with and without cookies).")),u(r.a,null,"Using a JWT."),u("p",null,"A valid JWT will act as the currency for an authenticated user."),u("p",null,"The first step is to authenticate the user and issue a valid JWT. This step is required in both browser and non-browser contexts."),u("iframe",{style:{border:"none"},width:"800",height:"450",src:"https://whimsical.com/embed/SbMorpCErV6dxWZH9Jhioq"}),u(r.a,null,"Splitting the cookie."),u("p",null,"Now that the client has a valid JWT, it will need to be sent with each request to the GraphQL API."),u("p",null,"Storing JWTs in a SPA is notoriously tricky. Most of the options present a security risk as the entire JWT ends up being available to JavaScript. As such, retrieval of the JWT might be possible with common exploits such as cross-site scripting."),u("p",null,"To avoid these scenarios, we'll split the JWT content (",u(l.a,null,"{","header","}",".","{","payload","}",".","{","signature","}"),") across two cookies."),u("p",null,"The first cookie will contain the"," ",u(l.a,null,"{","header","}",".","{","payload","}")," ","content from the JWT with the following attributes:"),u("ul",null,u("li",null,"Expiry: 30 minutes"),u("li",null,"SameSite: Lax"),u("li",null,"Secure: yes")),u("p",null,"The second cookie will contain the"," ",u(l.a,null,"{","signature","}")," ","content from the JWT with the following attributes:"),u("ul",null,u("li",null,"Expiry: session"),u("li",null,"HTTPOnly: yes"),u("li",null,"SameSite: Lax"),u("li",null,"Secure: yes")),u("p",null,"Splitting the JWT across two cookies provides the following benefits:"),u("ul",null,u("li",null,"The entire JWT never exists in JavaScript."),u("li",null,"JavaScript can still extract user information from a cookie containing the ",u(l.a,null,"payload")," portion of the JWT."),u("li",null,"Each request made in a browser context will automatically include all authentication content."),u("li",null,"The ",u(l.a,null,"signature")," cookie is"," ",u(l.a,null,"HTTPOnly")," so it is not available to JavaScript and helps to protect against XSS."),u("li",null,"Using ",u(l.a,null,"SameSite")," ",u(l.a,null,"Lax")," cookies will provide some protection against CSRF."),u("li",null,"Using ",u(l.a,null,"Secure")," cookies will help to mitigate man-in-the-middle attacks.")),u(r.a,null,"Optionally, reconstructing the JWT"),u("p",null,"Each request to the GraphQL API will need to be authenticated with a valid JWT."),u("p",null,"Browsers will supply the JWT via two cookies, and API clients will provide the JWT via an ",u(l.a,null,"Authorization")," header."),u("p",null,"The GraphQL API will need to respond to all requests, regardless if they're coming from a browser or not."),u("p",null,"In the context of an API client, an ",u(l.a,null,"Authorization")," ","header containing a JWT will be supplied."),u("p",null,"In the context of the browser, the server will be responsible for creating an ",u(l.a,null,"Authorization")," header by reconstructing a JWT from the content within the two cookies. Constructing the"," ",u(l.a,null,"Authorization")," header will ensure that all future processing of the request is identical for browser-based and non-browser-based applications alike."),u("p",null,"Each request should be inspected for cookies and if found, their content to be used in reconstructing the JWT and creating an",u(l.a,null,"Authorization")," header."),u("iframe",{style:{border:"none"},width:"800",height:"450",src:"https://whimsical.com/embed/NEi2VS4ijQaV6UnnLucAbE"}),u(r.a,null,"Guarding against CSRF"),u("p",null,"While using cookies to store the JWT (rather than storing it in local storage or session storage) protects applications from some type of attacks, it makes them vulnerable to others, including CSRF."),u("p",null,"Using the"," ",u("a",{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy",target:"_blank"},"Same Origin Policy (SOP)"),", we can mitigate CSRF by requiring that a custom header exists if supplying the JWT via cookies. This is described as a"," ",u("a",{href:"https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#use-of-custom-request-headers",target:"_blank"},"CSRF prevention technique on OWASP"),"."),u("p",null,"Processing of the cookies should only take place if a custom header with the correct information is supplied."),u("iframe",{style:{border:"none"},width:"800",height:"450",src:"https://whimsical.com/embed/CV9FRF4i53hnMqKUXJjrJm"}),u(r.a,null,"Validating the JWT"),u("p",null,"The GraphQL API should require a valid JWT in the"," ",u(l.a,null,"Authorization")," header."),u("p",null,"When validating the JWT, ensuring the following are checked:"),u("ul",null,u("li",null,"Verify the issuer."),u("li",null,"Verify the audience."),u("li",null,"Ensure the token is not expired.")),u(r.a,null,"Continue processing"),u("p",null,"At this point, if the JWT validated and the user roles have access to the GraphQL API queries being requested, continue processing the request using your GraphQL framework."))}},aOVY:function(e,t,n){"use strict";var i=n("wx14"),a=n("Ff2n"),r=n("MX0m"),o=n.n(r),l=n("q1tI"),s=n.n(l).a.createElement;t.a=function(e){var t=e.children,n=Object(a.a)(e,["children"]);return s("code",Object(i.a)({},n,{className:"jsx-3161884056 "+(n&&null!=n.className&&n.className||"")}),t,s(o.a,{id:"3161884056"},["code.jsx-3161884056{color:deepPink;font-family:Menlo,Monaco,monospace,serif;font-size:0.9em;}","code.jsx-3161884056::before{content:'\\`';}","code.jsx-3161884056::after{content:'\\`';}"]))}},h1bS:function(e,t,n){"use strict";var i=n("MX0m"),a=n.n(i),r=n("q1tI"),o=n.n(r),l=o.a.createElement;t.a=function(e){var t=e.children;return l(o.a.Fragment,null,l("h2",{className:"jsx-1083602474 heading"},t),l(a.a,{id:"1083602474"},[".heading.jsx-1083602474{text-transform:uppercase;font-weight:600;}"]))}},xnUM:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return s})),n.d(t,"c",(function(){return c}));var i="#2396ED",a="#F05033",r="#F7E018",o="#15C213",l="#68B145",s="#60DAFB",c="#ff5050"},yhlQ:function(e,t,n){"use strict";var i=n("MX0m"),a=n.n(i),r=n("q1tI"),o=n.n(r),l=o.a.createElement;t.a=function(e){var t=e.children;return l(o.a.Fragment,null,l("h2",{className:"jsx-3947944616 sub-heading"},t),l(a.a,{id:"3947944616"},[".sub-heading.jsx-3947944616{text-transform:uppercase;font-size:1.2em;font-weight:600;}"]))}}},[["NawR",0,2,1,3]]]);